<!-- templates/destinations/destination_detail.html -->
{% extends 'base.html' %}

{% block title %}{{ destination.name }} | Wanderlust{% endblock %}

{% block extra_css %}
<link rel="stylesheet" href="/static/css/destination_detail.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/css/lightgallery.min.css">
{% endblock %}

{% block content %}
<!-- Destination Hero -->
<section class="destination-hero" style="background-image: url('{{ destination.main_image.url }}');">
    <div class="destination-hero-content">
        <h1 data-aos="fade-up">{{ destination.name }}</h1>
        <p data-aos="fade-up" data-aos-delay="200"><i class="fas fa-map-marker-alt"></i> {{ destination.country.name }},
            {{ destination.country.continent.name }}</p>
    </div>
    <div class="destination-hero-overlay"></div>
</section>

<!-- Destination Info -->
<section class="destination-info py-5">
    <div class="container">
        <div class="row">
            <div class="col-lg-8">
                <!-- Description -->
                <div class="destination-section" data-aos="fade-up">
                    <h2>About {{ destination.name }}</h2>
                    <div class="destination-description">
                        {{ destination.description|linebreaks }}
                    </div>
                </div>

                <!-- Highlights -->
                <div class="destination-section" data-aos="fade-up">
                    <h2>Highlights</h2>
                    <div class="highlights-list">
                        {% for highlight in destination.highlights.splitlines %}
                        {% if highlight %}
                        <div class="highlight-item">
                            <div class="highlight-icon">
                                <i class="fas fa-check-circle"></i>
                            </div>
                            <div class="highlight-text">
                                {{ highlight }}
                            </div>
                        </div>
                        {% endif %}
                        {% endfor %}
                    </div>
                </div>

                <!-- Gallery -->
                <div class="destination-section" data-aos="fade-up">
                    <h2>Photo Gallery</h2>
                    <div class="gallery-container" id="lightgallery">
                        {% for image in destination.images.all %}
                        <a href="{{ image.image.url }}" class="gallery-item">
                            <img src="{{ image.image.url }}" alt="{{ image.caption|default:destination.name }}">
                        </a>
                        {% endfor %}
                    </div>
                </div>

                <!-- Packages -->
                <div class="destination-section" data-aos="fade-up">
                    <h2>Available Tour Packages</h2>
                    {% if destination.packages.exists %}
                    <div class="packages-list">
                        {% for package in destination.packages.all %}
                        <div class="package-card">
                            <div class="package-info">
                                <h3>{{ package.name }}</h3>
                                <div class="package-meta">
                                    <span><i class="far fa-calendar-alt"></i> {{ package.duration }} Days</span>
                                    <span><i class="fas fa-users"></i> Max: {{ package.group_size }} People</span>
                                    <span><i class="fas fa-hiking"></i> {{ package.get_difficulty_display }}</span>
                                </div>
                                <div class="package-price">
                                    {% if package.discount_price %}
                                    <span class="old-price">${{ package.price }}</span>
                                    <span class="current-price">${{ package.discount_price }}</span>
                                    {% else %}
                                    <span class="current-price">${{ package.price }}</span>
                                    {% endif %}
                                    <span class="price-unit">/ person</span>
                                </div>
                                <p>{{ package.description|truncatechars:150 }}</p>
                                <div class="package-actions">
                                    <a href="{% url 'package_detail' package.slug %}"
                                        class="btn btn-outline-primary">View Details</a>
                                    <a href="{% url 'create_booking' package.slug %}" class="btn btn-primary">Book
                                        Now</a>
                                </div>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="no-packages">
                        <p>Currently, there are no available packages for this destination. Please check back later or
                            contact us for custom tours.</p>
                    </div>
                    {% endif %}
                </div>

                <!-- Reviews -->
                <div class="destination-section" data-aos="fade-up">
                    <h2>Traveler Reviews</h2>
                    {% if destination.reviews.exists %}
                    <div class="reviews-container">
                        {% for review in destination.reviews.filter.is_approved %}
                        <div class="review-card">
                            <div class="review-header">
                                <div class="reviewer-info">
                                    <div class="reviewer-avatar">
                                        <img src="https://ui-avatars.com/api/?name={{ review.user.get_full_name|default:review.user.username }}&background=random"
                                            alt="{{ review.user.username }}">
                                    </div>
                                    <div class="reviewer-name">
                                        <h5>{{ review.user.get_full_name|default:review.user.username }}</h5>
                                        <span class="review-date">{{ review.created_at|date:"F d, Y" }}</span>
                                    </div>
                                </div>
                                <div class="review-rating">
                                    {% for i in "12345" %}
                                    {% if forloop.counter <= review.rating %} <i class="fas fa-star"></i>
                                        {% else %}
                                        <i class="far fa-star"></i>
                                        {% endif %}
                                        {% endfor %}
                                </div>
                            </div>
                            <div class="review-content">
                                <h4>{{ review.title }}</h4>
                                <p>{{ review.comment }}</p>
                            </div>
                        </div>
                        {% endfor %}
                    </div>
                    {% else %}
                    <div class="no-reviews">
                        <p>There are no reviews yet for this destination. Be the first to share your experience!</p>
                    </div>
                    {% endif %}

                    {% if user.is_authenticated %}
                    <div class="write-review-btn text-center mt-4">
                        <button class="btn btn-primary" data-bs-toggle="modal" data-bs-target="#reviewModal">Write a
                            Review</button>
                    </div>

                    <!-- Review Modal -->
                    <div class="modal fade" id="reviewModal" tabindex="-1" aria-hidden="true">
                        <div class="modal-dialog modal-dialog-centered">
                            <div class="modal-content">
                                <div class="modal-header">
                                    <h5 class="modal-title">Write a Review for {{ destination.name }}</h5>
                                    <button type="button" class="btn-close" data-bs-dismiss="modal"
                                        aria-label="Close"></button>
                                </div>
                                <div class="modal-body">
                                    <form method="post" action="{% url 'add_destination_review' destination.slug %}">
                                        {% csrf_token %}
                                        <div class="mb-3">
                                            <label class="form-label">Rating</label>
                                            <div class="rating-select">
                                                <div class="stars">
                                                    <input type="radio" name="rating" id="star5" value="5" required>
                                                    <label for="star5"><i class="far fa-star"></i></label>
                                                    <input type="radio" name="rating" id="star4" value="4">
                                                    <label for="star4"><i class="far fa-star"></i></label>
                                                    <input type="radio" name="rating" id="star3" value="3">
                                                    <label for="star3"><i class="far fa-star"></i></label>
                                                    <input type="radio" name="rating" id="star2" value="2">
                                                    <label for="star2"><i class="far fa-star"></i></label>
                                                    <input type="radio" name="rating" id="star1" value="1">
                                                    <label for="star1"><i class="far fa-star"></i></label>
                                                </div>
                                            </div>
                                        </div>
                                        <div class="mb-3">
                                            <label for="reviewTitle" class="form-label">Title</label>
                                            <input type="text" class="form-control" id="reviewTitle" name="title"
                                                required>
                                        </div>
                                        <div class="mb-3">
                                            <label for="reviewComment" class="form-label">Your Review</label>
                                            <textarea class="form-control" id="reviewComment" name="comment" rows="4"
                                                required></textarea>
                                        </div>
                                        <div class="text-end">
                                            <button type="button" class="btn btn-secondary"
                                                data-bs-dismiss="modal">Cancel</button>
                                            <button type="submit" class="btn btn-primary">Submit Review</button>
                                        </div>
                                    </form>
                                </div>
                            </div>
                        </div>
                    </div>
                    {% else %}
                    <div class="login-to-review text-center mt-4">
                        <p>Please <a href="#">login</a> to write a review</p>
                    </div>
                    {% endif %}
                </div>
            </div>

            <div class="col-lg-4">
                <!-- Sidebar -->
                <div class="destination-sidebar">
                    <!-- Map -->
                    <div class="sidebar-widget" data-aos="fade-up">
                        <h3>Location</h3>
                        <div class="map-container">
                            <iframe
                                src="https://www.google.com/maps/embed/v1/place?key=YOUR_API_KEY&q={{ destination.name }},{{ destination.country.name }}"
                                allowfullscreen></iframe>
                        </div>
                    </div>

                    <!-- Weather -->
                    <div class="sidebar-widget" data-aos="fade-up">
                        <h3>Weather</h3>
                        <div class="weather-container">
                            <div class="current-weather">
                                <div class="weather-icon">
                                    <i class="fas fa-sun"></i>
                                </div>
                                <div class="weather-info">
                                    <div class="temperature">28°C</div>
                                    <div class="weather-description">Sunny</div>
                                </div>
                            </div>
                            <div class="weather-forecast">
                                <div class="forecast-day">
                                    <div class="day-name">Mon</div>
                                    <div class="day-icon"><i class="fas fa-sun"></i></div>
                                    <div class="day-temp">28°</div>
                                </div>
                                <div class="forecast-day">
                                    <div class="day-name">Tue</div>
                                    <div class="day-icon"><i class="fas fa-cloud-sun"></i></div>
                                    <div class="day-temp">26°</div>
                                </div>
                                <div class="forecast-day">
                                    <div class="day-name">Wed</div>
                                    <div class="day-icon"><i class="fas fa-cloud"></i></div>
                                    <div class="day-temp">24°</div>
                                </div>
                                <div class="forecast-day">
                                    <div class="day-name">Thu</div>
                                    <div class="day-icon"><i class="fas fa-cloud-sun"></i></div>
                                    <div class="day-temp">25°</div>
                                </div>
                            </div>
                        </div>
                    </div>

                    <!-- Best Time to Visit -->
                    <div class="sidebar-widget" data-aos="fade-up">
                        <h3>Best Time to Visit</h3>
                        <div class="visit-time">
                            <p>The best time to visit {{ destination.name }} is from March to May and September to
                                November when the weather is pleasant and there are fewer tourists.</p>
                            <div class="season-months">
                                <div class="month-item active">Jan</div>
                                <div class="month-item active">Feb</div>
                                <div class="month-item best">Mar</div>
                                <div class="month-item best">Apr</div>
                                <div class="month-item best">May</div>
                                <div class="month-item">Jun</div>
                                <div class="month-item">Jul</div>
                                <div class="month-item">Aug</div>
                                <div class="month-item best">Sep</div>
                                <div class="month-item best">Oct</div>
                                <div class="month-item best">Nov</div>
                                <div class="month-item active">Dec</div>
                            </div>
                        </div>
                    </div>

                    <!-- Related Destinations -->
                    <div class="sidebar-widget" data-aos="fade-up">
                        <h3>Related Destinations</h3>
                        <div class="related-destinations">
                            {% for related in related_destinations %}
                            <a href="{% url 'destination_detail' related.slug %}" class="related-destination-item">
                                <div class="related-destination-img">
                                    <img src="{{ related.main_image.url }}" alt="{{ related.name }}">
                                </div>
                                <div class="related-destination-info">
                                    <h4>{{ related.name }}</h4>
                                    <p>{{ related.country.name }}</p>
                                </div>
                            </a>
                            {% endfor %}
                        </div>
                    </div>

                    <!-- Need Help -->
                    <div class="sidebar-widget need-help-widget" data-aos="fade-up">
                        <h3>Need Help?</h3>
                        <p>Our travel experts are here to assist you in planning your trip to {{ destination.name }}.
                        </p>
                        <div class="contact-info">
                            <div class="contact-item">
                                <i class="fas fa-phone"></i>
                                <span>+1 (123) 456-7890</span>
                            </div>
                            <div class="contact-item">
                                <i class="fas fa-envelope"></i>
                                <span>info@wanderlust.com</span>
                            </div>
                        </div>
                        <a href="{% url 'contact' %}" class="btn btn-primary w-100 mt-3">Contact Us</a>
                    </div>
                </div>
            </div>
        </div>
    </div>
</section>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/lightgallery@2.4.0/lightgallery.min.js"></script>
<script src="/static/js/destination_detail.js"></script>
{% endblock %}